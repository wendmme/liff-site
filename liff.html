<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>サイト診断 LIFF</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<p>診断フォームへリダイレクト中…</p>
<script>
// liff.init({ liffId: '2007865582-nJ0DMwPM' })  // ← “https://” を付けない！
// LINE 以外のブラウザでも自動ログインさせる
liff.init({ liffId: '2007865582-nJ0DMwPM', withLoginOnExternalBrowser:true })
-.then(() => {
-  const uid = liff.getContext().userId || 'unknown';
+// ★ ログインしていなければまずログイン
+.then(() => { if (!liff.isLoggedIn()) { liff.login(); return; } })
+// ★ プロフィール取得（外部ブラウザでも userId が取れる）
+.then(() => liff.getProfile())
+.then(profile => {
+  const uid = profile.userId || 'unknown';
+  console.log('uid=',uid);           // ←デバッグ用ログ
  location.href = url;
});
</script>
</body>

</html>


